machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker build -f dockerfiles/Dockerfile.ubuntu-trusty-wercker -t ymotongpoo/ubuntu-trusty:wercker .

test:  
  override:
    - echo "move to ergodox_ez directory"
    - cd $HOME/qmk_firmware/keyboard/ergodox_ez
    - echo "build firmware"
    - make KEYMAP=$TARGET_KEYMAP

deployment:
  deploy:
    branch: master
    commands:
      - cd $HOME/qmk_firmware/keyboard/ergodox_ez
      - echo "put built hex file to bintray"
      - curl -T ergodox_ez.hex -u$BINTRAY_USERNAME:$BINTRAY_APIKEY https://api.bintray.com/content/$BINTRAY_USERNAME/generic/ergodox.hex/$WERCKER_GIT_BRANCH-circle-$WERCKER_GIT_COMMIT/ergodox.hex
      - echo "publish uploaded hex file"
      - curl -X POST -u$BINTRAY_USERNAME:$BINTRAY_APIKEY https://api.bintray.com/content/$BINTRAY_USERNAME/generic/ergodox.hex/$WERCKER_GIT_BRANCH-circle-$WERCKER_GIT_COMMIT/publish